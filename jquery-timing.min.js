(function(z,G){var L="__timeouts",B="__intervals",A=undefined,w=true,F="fx",o={},E=G.setTimeout,u=G.clearTimeout,f=G.setInterval,M=G.clearInterval;function k(N){return typeof N=="function"}function h(N){return typeof N=="string"}function v(P,O){P=P||[];for(var N=0;N<P.length;N++){if(P[N]===O){if(N<P.length-1){P[N]=P.pop();N--}else{P.pop()}}}return P}function H(O,N){O=O||[];O.push(N);return O}function J(O,T,Q){var P={_isChainEnd:w,_trigger:{}},N={h:P,c:O,_methodName:T,_methodArguments:Q},S={_activeExecutionPoint:N,_ongoingLoops:[],_openEndLoopTimeout:E(function(){S._openEndLoopTimeout=A;D(S,P)},0)},R={};for(key in O){if(k(O[key])){(function(U){R[U]=function(){N=N.h={h:P,c:P.c,_methodName:U,_methodArguments:arguments};if(S._activeExecutionPoint._isChainEnd){S._activeExecutionPoint=N;D(S)}return R}})(key)}}D(S);return R}function D(Q,S){if(S){S._trigger._isTriggered=w;if(Q._activeExecutionPoint!=S){return}}for(var P,O,R,N;P=Q._activeExecutionPoint;){if(P._isChainEnd){if(Q._ongoingLoops[0]&&!Q._openEndLoopTimeout){Q._activeExecutionPoint=Q._ongoingLoops[0];Q._activeExecutionPoint.d++;continue}break}N=P._trigger;if(N){if(N._isTriggered&&!N._isInterrupted){m(Q)}else{break}}O=P.c;R=O[P._methodName];if(R==c){(N&&N._isTriggered?d:C)(Q,P)}else{if(R==g){(N&&N._isTriggered?K:s)(Q,P)}else{if(R==r){P.b=P._methodArguments[0];m(Q)}else{if(R==y){(N&&N._isTriggered?b:p)(Q,P)}else{if(R==i&&Q._ongoingLoops[0]){if(j(Q,P)){m(Q);e(Q)}else{Q._activeExecutionPoint=Q._ongoingLoops[0];Q._activeExecutionPoint.d++;continue}}else{O=R.apply(O,P._methodArguments);m(Q)}}}}}Q._activeExecutionPoint.c=O}}function m(O,N){N=O._activeExecutionPoint;if(k(N.b)){t(O,N.c,N.b)}O._activeExecutionPoint=N.h}function t(P,O,Q,N){N=[];z.each(P._ongoingLoops,function(){N.push(this.d)});return Q.apply(O,N)}function C(Q,P,O){function N(){D(Q,P)}if(k(P._methodArguments[0])){P.b=P._methodArguments[0]}else{O=P._methodArguments[0];P.b=P._methodArguments[1]}P._trigger=h(O)?{_type:"event",_action:N,c:P.c.bind(O,N),_value:O}:{_type:"timer",_action:N,_value:E(N,Math.max(0,O))};P.c.each(function(R,S){z(S).data(L,H(z(S).data(L),P._trigger))})}function x(N){if(N._type=="event"){N.c.unbind(N._value,N._action)}else{u(N._value)}N._isInterrupted=w}function d(O,N){x(N._trigger);N.c.each(function(P,Q){z(Q).data(L,v(z(Q).data(L),N._trigger))});N._trigger=A}function s(P,O,N){if(k(O._methodArguments[0])){O.b=O._methodArguments[0]}else{N=O._methodArguments[0];O.b=O._methodArguments[1]}O._trigger={};O.c.queue(N==A?F:N,function(Q){D(P,O);Q()})}function K(O,N){N._trigger=A}function p(R,P,O,Q){function N(){D(R,P)}if(k(P._methodArguments[0])){P.b=P._methodArguments[0]}else{if(k(P._methodArguments[1])){O=P._methodArguments[0];P.b=P._methodArguments[1]}else{O=P._methodArguments[0];Q=P._methodArguments[1];P.b=P._methodArguments[2]}}P._trigger=O==A?{_isTriggered:w}:h(O)?{_type:"event",_action:N,c:P.c.bind(O,N),_value:O,_isTriggered:Q}:{_type:"timer",_action:N,_value:f(N,Math.max(0,O)),_isTriggered:Q};P.c.each(function(S,T){z(T).data(B,H(z(T).data(B),P._trigger))});P.d=0;R._ongoingLoops.unshift(P)}function b(O,N){N._trigger._isTriggered=!N._trigger._type}function q(N){if(N._type=="event"){N.c.unbind(N._value,N._action)}if(N._type=="timer"){M(N._value)}N._isInterrupted=w}function e(O,N){N=O._ongoingLoops.shift();q(N._trigger);N.c.each(function(P,Q){z(Q).data(B,v(z(Q).data(B),N._trigger))});N._trigger=A}function j(O,N,P){P=N._methodArguments[0];if(P==A){P=!N.c.size()}if(k(P)){P=t(O,N.c,P)}if(typeof P=="object"){P=P.toString()}return typeof P=="number"?O._ongoingLoops[0].d>=P-1:P}function c(){return J(this,"wait",arguments)}function n(){return this.each(function(N){N=z(this).data(L);while(N&&N.length){x(N.pop())}})}function y(){return J(this,"repeat",arguments)}function a(){return this.each(function(N){N=z(this).data(B);while(N&&N.length){q(N.pop())}})}function i(){throw".until() method must be used after .repeat() only"}function r(N){N.apply(this);return this}function g(){return J(this,"join",arguments)}function l(N,P,O){if(h(N)){Array.prototype.shift.apply(O)}else{N=""}return P.apply(o[N]=(o[N]||z("<div>").text(N)),O)}z.fn.extend({wait:c,unwait:n,repeat:y,unrepeat:a,until:i,then:r,join:g,$:z});z.extend({wait:function(N){return l(N,c,arguments)},unwait:function(N){return l(N,n,arguments)},repeat:function(N){return l(N,y,arguments)},unrepeat:function(N){return l(N,a,arguments)},then:function(N){return l(N,r,arguments)},join:function(N){return l(N,g,arguments)}});function I(Q,O){if(h(Q)){Q=new Function("x","return "+Q)}var N=k(O),R=k(Q),P=function(S){if(arguments.length){P.value=S;if(N){O(S)}}return P.toString()};P.toString=function(){var S=N?O():P.value;return R?Q(S):S};P.$={toString:P.toString};P.mod=function(S){return I(function(T){return T%S},P)};P.plus=function(S){return I(function(T){return T+S},P)};P.neg=function(){return I(function(S){return -S},P)};return P}G.$$=I})(jQuery,window);