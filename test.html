<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<style type="text/css">
table {
	empty-cells: show;
	border-collapse: collapse;
	border: none;
	padding: 0;
	margin: 1em;
}
td, th {
	padding: 3px;
	margin: 0;
	text-align: left;
}
tr, th {
	border: 1px solid #ccc;
}
th.method {
	font-weight: normal;
	font-family: monospace;
}
th.title {
	padding: 1em;
}
th.jquery {
	text-align: center;
}
td {
	background-color: white;
	border-right: 1px solid #ccc;
}
td.result {
	width: 20px;
	height: 20px;
}
td.run {
	background: url(tests/run.gif) no-repeat center center scroll;
	color: transparent;
}
td.ok {
	background: url(tests/ok.png) no-repeat center center scroll;
	color: transparent;
}
td.fail {
	background: url(tests/fail.png) no-repeat center center scroll;
	color: transparent;
}
td.error {
	background: url(tests/error.png) no-repeat center center scroll;
	color: transparent;
}
td.x {
	background-color: #eef;
	border-right: none;
}
tr.y td {
	background-color: #fee;
}
tr.y td.x {
	background-color: #fdf;
}
h2 {
	border-bottom: 1px solid navy;
	margin: 2em 0;
}
th.method:hover, h2:hover, th.title:hover, th.jquery:hover, td:hover {
	background-color: navy !important;
	color: white;
	cursor: pointer;
}

.summary {
	color: maroon;
}
</style>
</head>
<body>

<h1>Automated Tests for <em>jquery-timing.js</em> and <em>jquery-timing.min.js</em><br/><small>against jQuery 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8b1</small></h1>

<script type="text/javascript">
var jQueries = {};
function savejQuery(type, version) {
	version = version || $.fn.jquery;
	jQuery.fn.jquery = version;
	jQueries[version] = jQueries[version] || {};
	jQueries[version][type] = jQuery.noConflict(); 
}
</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.2.1.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.2.1.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.2.6.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.2.6.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.3.1.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.3.1.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.3.2.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.1.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.1.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.4.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.5.1.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.5.2.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.5.2.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.1.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.8b1.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js','1.8.-1')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.8b1.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js','1.8.-1')</script>

<script type="text/javascript" src="http://code.jquery.com/jquery.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.js')</script>
<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
<script type="text/javascript" src="jquery-timing.min.js"></script>
<script type="text/javascript">savejQuery('jquery-timing.min.js')</script>

<p><button>Run all tests again&hellip;</button></p>

<h1 class="summary"></h1>
<h1 class="summary"></h1>

<p><button>Run all tests again&hellip;</button></p>

<script type="text/javascript">var tests = {};</script>
<script charset="utf-8" type="text/javascript" src="tests/test.wait.js"></script>
<script type="text/javascript">tests[".wait() functionality"] = suite;</script>
<script charset="utf-8" type="text/javascript" src="tests/test.repeat.js"></script>
<script type="text/javascript">tests[".repeat() functionality"] = suite;</script>
<script charset="utf-8" type="text/javascript" src="tests/test.join.js"></script>
<script type="text/javascript">tests[".join() functionality"] = suite;</script>
<script charset="utf-8" type="text/javascript" src="tests/test.bind.js"></script>
<script type="text/javascript">tests[".bind() functionality"] = suite</script>
<script charset="utf-8" type="text/javascript" src="tests/test.on.js"></script>
<script type="text/javascript">tests[".on() functionality"] = suite;</script>
<script charset="utf-8" type="text/javascript" src="tests/test.one.js"></script>
<script type="text/javascript">tests[".one() functionality"] = suite;</script>
<script charset="utf-8" type="text/javascript" src="tests/test.delegate.js"></script>
<script type="text/javascript">tests[".delegate() functionality"] = suite;</script>
<script charset="utf-8" type="text/javascript" src="tests/test.live.js"></script>
<script type="text/javascript">tests[".live() functionality"] = suite;</script>
<script charset="utf-8" type="text/javascript" src="tests/test.dom-events.js"></script>
<script type="text/javascript">tests["dom events functionality"] = suite;</script>
<script charset="utf-8" type="text/javascript" src="tests/test.var.js"></script>
<script type="text/javascript">tests["$$() functionality"] = suite;</script>
<script type="text/javascript" src="http://code.jquery.com/jquery.js"></script>
<script type="text/javascript" src="jquery-timing.js"></script>

<script type="text/javascript">
function compareVersion(v1,v2) {
	v1 = v1.split('.');
	v2 = v2.split('.');
	for (var i=0; i<3; i++) {
		var compare = Number(v1[i]||0) - Number(v2[i]||0);
		if (compare != 0)
				return compare;
	}
	return 0;
}
function checkVersionBounds(jquery, minVersion, maxVersion) {
	return compareVersion(jquery, minVersion || jquery) >= 0 && compareVersion(jquery, maxVersion || jquery) <= 0;
}

var assertionException = new Error("assertion violated");
var guid = 0;
function TestCase(success, error, $) {
	$.extend(this, {
		$: $,
		success: success,
		error: error
	});
}
$.extend(TestCase.prototype, {
	
	finished : false,
	
	check: function(){
		if (this.finished) {
			throw assertionException;
		} 
	},
	
	done: function() {
		if (this.finished) {
			throw assertionException;
		} 
		this.finished = true;
		this.success();
	},
	
	fail: function(message) {
		if (this.finished) {
			throw assertionException;
		}
		this.finished = true;
		this.error(message);
		throw assertionException;
	},
	
	assert: function(msg, condition){
		if (!condition) {
			this.fail(msg);
		}
	},
	
	assertTrue: function(msg, condition){
		this.assert(msg, condition);
	},
	
	assertFalse: function(msg, condition) {
		this.assert(msg, !condition);
	},
	
	assertEquals: function(msg, expected, value) {
		if (expected != value) {
			this.fail(msg+'\n'+expected+' != '+value+'');
		}
	},
	
	assertNotEquals: function(msg, expected, value) {
		if (expected == value) {
			this.fail(msg+'\n'+expected+' == '+value+'');
		}
	},
	
	guid: function() {
		return ++guid;
	}
	
});

var count=0;
var passed=0;
var fails=0;
var errors=0;
$(function(){
	$('h1:first, button').click(function(){
		window.location.hash='';
		window.location.reload();
	});
	var $summary = $('.summary');
	
	function updateResults() {
		var still = count-passed-fails-errors;
		$summary.html('tests: '+count+'; passed:'+passed+'; failures:'+fails+'; errors:'+errors+'; still running:'+((still > 0) ? still+'&hellip;' : still));
	}
	
	var filter = String(window.location.hash).replace(/^#/,'').split('|');
	$.each(tests, function(part, suite){
		if (filter[0] && part != filter[0]) {
			return;
		}
		var $headline = $('<h2>').text(part).insertBefore($summary.last()).click(function(){
			window.location.replace('#'+[part].join('|'));
			window.location.reload();
		});			
		var $table = $('<table>').insertBefore($summary.last());
		
		var sectionBounds = [];				
		$.each(suite, function(section, methods){
			if (section == '_version') {
				sectionBounds = $.makeArray(methods);
				return;
			}
			if (filter[1] && section != filter[1]) {
				return;
			}
			var $tbody = $('<tbody>').appendTo($table);
			var $tr = $('<tr>').append($('<th class="title">').text(section).click(function(){
				window.location.replace('#'+[part,section].join('|'));
				window.location.reload();
			})).appendTo($tbody);
			$.each(jQueries, function(version){
				$('<th colspan="2" class="jquery">').text(version).attr('title','jQuery version '+version).click(function(){
					window.location.replace('#'+[part,section,'',version].join('|'));
					window.location.reload();
				}).appendTo($tr);
			});
			$.each(methods, function(name, testMethod){
				var methodBounds = name.split('|');
				name = methodBounds.shift();
				methodBounds[0] = methodBounds[0] || sectionBounds[0];
				methodBounds[1] = methodBounds[1] || sectionBounds[1];
				
				if (filter[2] && name != filter[2]) {
					return;
				}
				var $tr = $('<tr>').append($('<th class="method">').text(name).click(function(){
					window.location.replace('#'+[part,section,name].join('|'));
					window.location.reload();
				})).appendTo($tbody);
				$.each(jQueries, function(version, types){
					
					var versionMatch = checkVersionBounds(version, methodBounds[0],methodBounds[1]);
					
					$.each(types, function(type, _jQuery){
						
						var $td = $('<td class="result">…').addClass('run').attr('title','jQuery '+version+' + '+type).click(function(){
							if (count == 1 && filter[0] == part && filter[1] == section && filter[2] == name && filter[3] == version && filter[4] == type) {
								return alert($(this).attr('title'));
							}
							window.location.replace('#'+[part,section,name,version,type].join('|'));
							window.location.reload();
						}).appendTo($tr);
						

						if (filter[3] && version != filter[3] || filter[4] && type != filter[4] || !versionMatch && !filter[3]) {
							return $td.removeClass('run').text('-');
						}						
						count++;
						window.setTimeout(function(){
							var testCase = new TestCase(function(){
								$td.removeClass('run').addClass('ok').text('+');
								passed++;
								updateResults();
							}, function(message){
								$td.removeClass('run').addClass('fail').text('-').attr('title',message || 'error');
								fails++;
								updateResults();
							}, _jQuery);
							try {
								window.setTimeout(function(){
									try {
										testCase.assertTrue(testCase.finished || !$td.addClass('error'), 'processing timeout exceeded');										
									} catch (error) {}
								}, 10000)
								testMethod(_jQuery, testCase);
							} catch(error) {
								if ((error !== assertionException) && !testCase.finished) {									
									testCase.finished = true;
									$td.removeClass('run').addClass('error').text('!').attr('title',String(error));
									errors++;
									updateResults();
									throw error;
								}
							}
						}, 500+count*3);
					});
				});
			});
		});
	});
	$summary.text('~'+count+' tests');
	
	$('td:even').addClass('x');
	$('tr:even').addClass('y');
});
</script>
</body>
</html>
